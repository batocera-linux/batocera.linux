<features>
	<vgroup name="Top bar" role="header">
		<feature>
			<text display="${batocera-info --short}" refresh="2" />
		</feature>
		<feature display="Batocera">
			<text display="${batocera-version | cut -d' ' -f1}" />
		</feature>
	</vgroup>

	<feature name="shortcuts_tabs" display="Quick Access">
		<tab display="Game" target="Game" align="right" if="${curl http://127.0.0.1:1234/runningGame | jq -r '.systemName' | sed 's/^null$//'}" />
		<tab display="Gun" target="Gun" if="${curl -s http://127.0.0.1:1234/runningGame | jq -r '.name' | grep -qE '^null$' || ls /var/run/batocera-overlays/gun_help.png}" />
		<tab display="System" target="System" align="right" />
	</feature>
	<hgroup name="Game" display="Game">
		<hgroup>
                        <feature>
		                <img display='${IMG=$(curl http://127.0.0.1:1234/runningGame | jq -r ".marquee"); [ -n "$IMG" ] &amp;&amp; [ "$IMG" != "null" ] &amp;&amp; echo http://127.0.0.1:1234$IMG }' height="90" refresh="3" align="left" id="gamemarquee" />
				<text display="${curl http://127.0.0.1:1234/runningGame | jq -r '.name' | sed 's/null//'}" align="left" refresh="3" if="!id(gamemarquee)" />
				<text display="${curl http://127.0.0.1:1234/runningGame | jq -r '.systemName' | sed 's/\(.*\)/[\1]/'}" align="left" refresh="3" />
			</feature>
			<feature>
				<text display='${P=$(ps -o etime= -C emulatorlauncher 2>/dev/null | head -1 | tr -d [[:blank:]]) &amp;&amp; [ -n "$P" ] &amp;&amp; echo "Playing for $P."}' align="left" refresh="1" id="playtime" />
			</feature>
		</hgroup>
		<vgroup>
			<feature>
				<button_confirm display="Quit game" action="hotkeygen --send exit" />
				<doc display="Manual" content='${IMG=$(curl http://127.0.0.1:1234/runningGame | jq -r .manual | sed "s/null//"); [ -n "$IMG" ] &amp;&amp; [ "$IMG" != "null" ] &amp;&amp; echo http://127.0.0.1:1234$IMG}' id="manual" refresh="3"/>
				<doc display="Map" content='${IMG=$(curl http://127.0.0.1:1234/runningGame | jq -r .map | sed "s/null//"); [ -n "$IMG" ] &amp;&amp; [ "$IMG" != "null" ] &amp;&amp; echo http://127.0.0.1:1234$IMG}' id="map" refresh="3"/>
			</feature>
		</vgroup>
		<vgroup>
                        <img display='${IMG=$(curl http://127.0.0.1:1234/runningGame | jq -r ".thumbnail"); [ -n "$IMG" ] &amp;&amp; [ "$IMG" != "null" ] &amp;&amp; echo http://127.0.0.1:1234$IMG || echo "/usr/share/emulationstation/resources/services/logo-tri.png"}' height="200" refresh="3" />
			<hgroup>
				<qrcode display='${IMG=$(curl http://127.0.0.1:1234/runningGame | jq -r ".cheevosId"); [ -n "$IMG" ] &amp;&amp; [ "$IMG" != "null" ] &amp;&amp; echo https://retroachievements.org/game/$IMG}' height="160" refresh="2" id="cheevos" bg="#141821" />
				<text display="RetroAchievements" if='${curl http://127.0.0.1:1234/runningGame | jq -r ".cheevosId" | sed "s/null//"}' refresh="2"/>
			</hgroup>
			<img display="${curl http://127.0.0.1:1234/runningGame | jq -r '.systemName' | sed 's:\(.*\):/usr/share/batocera/controller-overlays/\1.png:'}" refresh="5" align="center" />
		</vgroup>
		<hgroup>
		</hgroup>
	</hgroup>
        <hgroup name="Gun" display="Gun">
          <img display='${echo /var/run/batocera-overlays/gun_help.png}' refresh="5" align="center" />
        </hgroup>
	<hgroup name="System" display="Sound &amp; Power">
		<feature>
				<button display="Vol -" action="batocera-audio setSystemVolume -5" />
				<progressbar display="${batocera-audio getSystemVolume}" min="0" max="100" refresh="1" />
				<button display="Vol +" action="batocera-audio setSystemVolume +5" />
		</feature>
		<feature if='${printf "%s" $(batocera-brightness 2&gt;/dev/null)}'>
				<button display="Bright -" action="batocera-brightness - 10" />
				<progressbar display="${batocera-brightness}" min="0" max="100" refresh="1" />
				<button display="Bright +" action="batocera-brightness + 10" />
		</feature>
		<feature display="Mute Sound" group="Audio/Video">
			<switch value="${batocera-audio getSystemMute}" refresh="2"
				action_on="batocera-audio setSystemVolume mute" action_off="batocera-audio setSystemVolume unmute" />
		</feature>
		<feature display="Network IP address:">
			<text display='${printf "%s " "$(ip -4 addr show | grep -oP "(?&lt;=inet\s)\d+(\.\d+){3}" | grep -v "127.0.0.1" | head -n1)" ; for d in /sys/class/net/*; do n=$(basename "$d"); if [ "$n" != lo ]; then printf "%s: %s, " "$n" "$(cat "$d/operstate")"; fi; done | sed "s/, $//"}' refresh="5" align="left" />
		</feature>
		<feature display="Free data storage:">
			<text display="${df -h $(batocera-part share) | awk '/\/userdata$/ {print $4}'}" refresh="10" align="left" />
		</feature>
		<feature display="Plane Mode" group="Audio/Video">
			<switch value="${batocera-planemode status}"
			action_on="batocera-planemode enable" action_off="batocera-planemode disable" refresh="2" align="left"/>
		</feature>
		<feature display="Stuck emulator?">
			<button_confirm display="Kill it!" action="curl http://127.0.0.1:1234/emukill" align="left" />
		</feature>
		<feature name="PowerMode" display="Power Mode">
			<choice display="Default"      action="batocera-power-mode default" />
			<choice display="AC"           action="batocera-power-mode ac" />
			<choice display="Battery"      action="batocera-power-mode battery" />
			<choice display="High Perf"    action="batocera-power-mode highperformance" />
			<choice display="Balanced"     action="batocera-power-mode balanced" />
			<choice display="Saver"        action="batocera-power-mode Powersaver" />
			<text display="${cat /sys/devices/system/cpu/cpufreq/policy0/scaling_governor}" refresh="1" />
		</feature>
	</hgroup>
	<vgroup name="Bottom bar" role="footer">
		<feature display="CPU:">
			<progressbar display="${ { head -n1 /proc/stat; sleep 0.2; head -n1 /proc/stat; } | awk '/^cpu /{u=$2-u; s=$4-s; i=$5-i; w=$6-w} END {print int(0.5+100*(u+s+w)/(u+s+i+w))}'}" min="0" max="100" refresh="1" />
		</feature>
		<feature display="Temp:">
			<text display='${ TEMPE=$(cat /sys/devices/virtual/thermal/thermal_zone*/temp /sys/class/hwmon/hwmon*/temp*_input 2>/dev/null | sort -rn | head -1 | sed -e s+"[0-9][0-9][0-9]$"++); [ -n "$TEMPE" ] &amp;&amp; echo "$TEMPE"C || echo "N/A" }' refresh="3" />
		</feature>
		<feature display="Resolution:">
			<text display="${batocera-resolution currentResolution}" />
		</feature>
	</vgroup>
</features>

